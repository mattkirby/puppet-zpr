#!/usr/bin/env python

import os
import sys
import invoke

from invoke import run

def ZprRsyncForcedCommands ():
    original_command  = os.environ['SSH_ORIGINAL_COMMAND']
    commands_dir      = '<%= @authorized_commands_dir %>'
    commands_list_dir = os.listdir(commands_dir)
    static_commands   = []

    for command in commands_list_dir:
        static_commands.append(open('/'.join([ commands_dir, command ])).read().rstrip('\n'))

    if original_command in static_commands:
        command_index    = static_commands.index(original_command)
        filtered_command = static_commands[command_index]
        run(filtered_command, hide=True, warn=True)
    else:
        print "The command requested is not permitted to run on this system"
        sys.exit(1)

if __name__ == "__main__":
    ZprRsyncForcedCommands()
